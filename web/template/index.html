<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="/web/static/style.css">
    </head>
    <body>
      <div class="header">
        {{.PageTitle}}
      </div>
      <div class="main">
        <table id="constructors" class="data-table" border="1" frame="void" rules="all" cellspacing="0" cellpadding="5">
          <tr>
            <th>Constructor Name</th>
            <th>Nationality</th>
            <th>Years Active</th>
            <th>Constructors Titles</th>
            <th>Win Rate</th>
          </tr>
          {{range .Constructors}}
          <tr>
            <td><a href="{{.URL}}">{{.Name}}</a></td>
            <td>{{.Nationality}}</td>
            <td>{{.YearsActiveH}}</td>
            <td>
                {{.ConTitleCount}}:
                {{range .ConstructorsTitles}}
                  {{.}},
                {{end}}
            </td>
            <td>{{.WinRateH}}</td>
          </tr>
          {{end}}
        </table>
      </div>
      <script>
        //stolen from https://stackoverflow.com/questions/14267781/sorting-html-table-with-javascript
        const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

        const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
          v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
          )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

        // do the work...
        document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
          const table = th.closest('table');
          Array.from(table.querySelectorAll('tr:nth-child(n+2)'))
              .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
              .forEach(tr => table.appendChild(tr) );
        })));
      </script>
    </body>
</html>
